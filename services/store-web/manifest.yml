applications:
- name: store-web
  memory: 256m
  path: target/store-web-1.0.0.jar
  random-route: true
  env:
    SERVER_TOMCAT_MAX_THREADS: 4
    JAVA_OPTS: -XX:ReservedCodeCacheSize=32M -Xss512k -Duser.timezone=Asia/Tokyo
    JBP_CONFIG_OPEN_JDK_JRE: '{memory_calculator: {stack_threads: 20}, jre: {version: 11.+}}'
    EUREKA_CLIENT_SERVICEURL_defaultZone: ${vcap.services.discovery.credentials.url}/eureka/
    EUREKA_INSTANCE_HOSTNAME: ${vcap.application.uris[0]}
    EUREKA_INSTANCE_SECURE_PORT_ENABLED: true
    EUREKA_INSTANCE_SECURE_PORT: 443
    EUREKA_INSTANCE_NON_SECURE_PORT_ENABLED: false
    EUREKA_INSTANCE_HOME_PAGE_URL: https://${eureka.instance.hostname}
    EUREKA_INSTANCE_STATUS_PAGE_URL: https://${eureka.instance.hostname}/actuator/info
    EUREKA_INSTANCE_HEALTH_CHECK_URL: http://${eureka.instance.hostname}/actuator/health
    EUREKA_INSTANCE_SECURE_HEALTH_CHECK_URL: https://${eureka.instance.hostname}/actuator/health
    EUREKA_INSTANCE_METADATAMAP_instanceId: ${vcap.application.instance_id}
    SPRING_ZIPKIN_BASE_URL: ${vcap.services.zipkin.credentials.url}
    SPRING_ZIPKIN_DISCOVERY_CLIENT_ENABLED: false
    MANAGEMENT_METRICS_TAGS_ORGANIZATION: ${vcap.application.organization_name}
    MANAGEMENT_METRICS_TAGS_SPACE: ${vcap.application.space_name}
    MANAGEMENT_METRICS_TAGS_APPLICATION: ${vcap.application.application_name}
    MANAGEMENT_METRICS_TAGS_INSTANCE_ID: ${management.metrics.tags.application}:${vcap.application.instance_index}

  services:
  - discovery
  - zipkin
  - metrics-endpoint-actuator-prometheus
    # cf create-user-provided-service metrics-endpoint-actuator-prometheus -l metrics-endpoint:///actuator/prometheus